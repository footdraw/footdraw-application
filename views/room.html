<html>
<head>
	<title>Foot Node</title>
	
	<!--link rel="stylesheet" type="text/css" href="assets/styles.css"-->
	<!--[if lt IE 9]>
          <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <style type="text/css">
    	* { 
		   margin: 0;
		   padding: 0;
		}
		body, html{
		   width: 100%;
		   height: 100%;
		}
		#canvas {
		   display: block;
		}
    </style>
</head>
<body>
	<h1>FootDrawer</h1>
		<canvas id="drawing">
			Your browser needs to support canvas for this to work!
		</canvas>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.6/socket.io.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

		<script type="text/javascript">
			var mouse = { 
			  click: false,
			  move: false,
			  pos: {x:0, y:0},
			  pos_prev: false
			};
		   var canvas  = document.getElementById('drawing');
		   var context = canvas.getContext('2d');
		   var width   = window.innerWidth;
		   var height  = window.innerHeight;
		   var socket  = io.connect();
		   canvas.width = width;
   	       canvas.height = height;

   	       canvas.onmousedown = function(e){
		      mouse.click = true;
		   };

   	       canvas.onmousemove = function(e){
   	       	  mouse.pos.x = e.clientX / width;
   	       	  mouse.pos.y = e.clientY / width;
		      mouse.move = true;
		   };

		   canvas.onmouseup = function(e){
		      mouse.click = false;
		   };

		   socket.on('draw_line', function (data) {
		      var line = data.line;
		      context.beginPath();
		      context.moveTo(line[0].x * width, line[0].y * height);
		      context.lineTo(line[1].x * width, line[1].y * height);
		      context.stroke();
		   });

		   function mainLoop() {
		      // check if the user is drawing
		      if (mouse.click && mouse.move && mouse.pos_prev) {
		         // send line to to the server
		         socket.emit('draw_line', { line: [ mouse.pos, mouse.pos_prev ] });
		         mouse.move = false;
		      }
		      mouse.pos_prev = {x: mouse.pos.x, y: mouse.pos.y};
		      setTimeout(mainLoop, 25);
		   }
		   mainLoop();
		</script>
</body>
</html>